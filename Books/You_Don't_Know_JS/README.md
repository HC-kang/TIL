# You Don't Know JS

## Part 1: 시작하기

### Chapter 1: 자바스크립트

#### 1.1 책에 대하여

#### 1.2 자바스크립트 이름의 유래

- 당연하게도, 자바스크립트는 자바와 관련이 없다.
  - 그렇지만 아이러니하게도 이 책은 정작 교보문고의 `프로그래밍-자바` 카테고리에 분류되어 있었다.
- 처음 명칭은 `Mocha`였다.
- 당시 '스크립트'라는 용어가 '간단한 프로그램'이라는 의미로 유행하였고, 자바 사용자들에게 어필하기 위해 `자바스크립트`라는 이름으로 변경되었다.
  - 실제로 자바와 자바스크립트는 C와 비슷한 형태의 문법을 사용한다는 공통점이 있긴 하다(`{}`, `;`의 사용 등)
- 현재는 공식적으로 ES20XX(ECMAScript) 혹은 JS라고 불린다.

#### 1.3 명세서

- TC39: ECMAScript 명세를 관리하는 위원회
- TC39에서는 새로운 기능을 추가하거나 기존 기능을 수정하는 등의 작업을 진행한다.
  - 모든 제안은 0~4단계(총 5단계)의 과정을 거쳐 다음 연도의 명세에 포함될 수 있다.

##### 1.3.1 JS를 지배하는 웹

- JS는 브라우저, 서버, 모바일, IoT 등 다양한 환경에서 사용된다.
- 그러나 가장 큰 영향력을 미치는 것은 웹이다.
- 명세에 변경이 생기는 경우, JS엔진 제조사는 이를 반영하여 엔진을 업데이트한다.
  - 그러나 이 과정에서 기존의 콘텐츠가 깨지는 경우 개정안을 적용하지 않는 경우도 있다.
  - 이런 경우 TC39는 결정을 철회하는 경우도 있다.
    - `contains()`를 추가하려다가 충돌로 `include()`로 변경되었다.
    - `flatten()`을 추가하려다가 충돌로 `flat()`으로 변경되었다.
  - 그러나 특수한 경우에는, 이를 부록 B, `Additional ECMAScript Features for Web Browsers`라는 별도의 명세로 추가하기도 한다.
    - 이는 웹 전용 기능을 추가하기 위한 것이며, 다른 환경은 명세서를 반드시 준수해야 한다.

##### 1.3.2 JS지만 JS가 아닌 웹 전용 문법

- `alert('Hello, JS!')`와 같은 코드는 JS이지만, JS 명세에는 없는 기능이다.
- 위에서 말한 부록 B에도 포함되어 있지 않다.
  - `fs.write()`, `console.*()`도 마찬가지이다.
  - 이런 기능은 특정 환경(브라우저 혹은 Node.js)에서만 사용되는 기능이거나, 명세에는 없지만 대부분의 환경에서 지원하는 기능이다.

##### 1.3.3 모든 코드가 JS인 것은 아닙니다

- 브라우저의 개발자도구 콘솔이나 Node.js의 REPL은 사실 순수한 JS환경이 아니다.
  - 이는 어디까지나 개발자를 위한, `JS에 우호적인 별도의 환경`일 뿐이라는것을 명심하고, 무조건 신뢰하지 말자.

#### 1.4 JS의 다양한 얼굴

- JS는 멀티 패러다임 언어이다.
  - 함수형, 객체지향, 프로토타입 기반, 명령형, 비동기 등 다양한 패러다임을 지원한다.

#### 1.5 하위 호환성과 상위 호환성

- 주요개념
  - `하위 호환성`: 새로운 버전이 이전 버전과 호환되는 것
  - `상위 호환성`: 이전 버전이 새로운 버전과 호환되는 것
- JS는 `하위 호환성`을 중요하게 생각한다.
  - 명세가 개정되더라도 이전 버전 코드의 작동을 보장한다.
- JS는 `상위 호환성`을 준수하지 않는다.
  - 따라서 새로운 코드는 이전 엔진에서 작동하지 않을 수 있다.

##### 1.5.1 간극을 줄이기 위한 노력

- 트랜스파일: 새로운 기능을 사용하여 코드를 작성하고, 이를 이전 버전에서도 작동할 수 있도록 변환하는 과정
  - Babel이 대표적인 트랜스파일러
  - 예시
    - Before

      ```js
      if (something) {
        let x = 3;
        console.log(x);
      } else {
        let x = 4;
        console.log(x);
      }
      ```

    - After

      ```js
      var x$0, x$1;
      if (something) {
        x$0 = 3;
        console.log(x$0);
      } else {
        x$1 = 4;
        console.log(x$1);
      }
      ```

##### 1.5.2 간극을 메우기 위한 방법 찾기

- 폴리필(Polyfill): 새로운 기능을 이전 버전에서도 사용할 수 있도록 구현한 코드. 심(shim)이라고도 불린다.
- 이러한 폴리필은 ES-Shim 등 공신력있는 라이브러리에서 제공한다.
  - 예시

  ```js
  var pr = getSomeRecords();

  startSpinner();

  pr
    .then(renderRecords)
    .catch(showError)
    .finally(hideSpinner); // <-- 이 부분이 ES2019에 추가된 기능
  ```

  - 이를 ES2019이전 환경에서도 사용할 수 있도록 폴리필을 작성한다.

  ```js
  if (!Promise.prototype.finally) {
    Promise.prototype.finally = function f(fn) {
      return this.then(
        function t(v) {
          return Promise.resolve(fn())
            .then(function t() {
              return v;
            });
        },
        function c(e) {
          return Promise.resolve(fn())
            .then(function t() {
              throw e;
            });
        }
      );
    };
  }
  ```

#### 1.6 인터프리터 이해하기

- 주요 개념
  - 인터프리터 언어: 코드를 실행하기 위해 런타임에 해석하는 언어. 한 줄씩 실행한다.
    - 스크립트 언어: 인터프리터 언어 중, 특히 브라우저에서 사용되는 언어
  - 컴파일러 언어: 코드를 실행하기 전에 미리 기계어로 변환하는 언어. 한 번에 실행한다.
- 저자는 JS가 컴파일 언어라고 주장한다.
  - JS는 실행 전에 전체 코드에 대해 파싱 과정을 거친다.
  - JS는 파싱 후 생성된 코드를 JIT 방식으로 처리 및 최적화 한다.
- JS의 실행 절차
  - `코드 작성` -> `트랜스파일` -> `번들링` -> `파싱`(코드 -> 추상 구문 트리 -> 바이트 코드) -> `최적화` -> `실행`
  -   개발자        Babel       Webpack    JS엔진(V8)    JS엔진(V8)     JS엔진(V8)    JS엔진(V8)  JS 가상 머신

##### 1.6.1 웹어셈블리

- ASM.js: JS의 하위 집합으로, 브라우저에서 더 빠르게 실행되도록 최적화된 코드
- Wasm: JS의 대체 언어로, 브라우저에서 더 빠르게 실행되도록 최적화된 코드

#### 1.7 엄격 모드

- `use strict`: 엄격 모드를 활성화하는 지시자
  - 이 전처리 구분 앞에는 공백이나 주석만 올 수 있다.
  - 파일이 아닌, 함수 단위로 적용할 수 있다.
- 하위 호환성을 고려하기에 아직 표준으로 채택되지 않았다.
  - 그러나 트랜스파일 결과물에는 `use strict`가 포함되어 있다.
  - 또한 현재는 대체로 모든 환경에서 ES2015 이상을 지원하므로, `use strict`를 사용했을 때 문제가 발생할 확률은 매우 낮다.

#### 1.8 정리

- JS는 ECMA 주최하에 TC39 위원회에서 관리하는 ECMAScript 표준을 구현한 언어이다.
- JS는 멀티 패러다임 언어이다.
- JS는 컴파일 언어이다.
