FROM docker:stable-dind

RUN apk add --no-cache nodejs npm

WORKDIR /usr/src/app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3000
CMD ["sh", "-c", "dockerd-entrypoint.sh & while(! docker info > /dev/null 2>&1); do sleep 1; done; docker run --rm --network host /usr/src/app:/usr/src/app -w /usr/src/app -p 3000:3000 node:alpine node app.js"]
